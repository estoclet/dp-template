<?php

/**
 * @file
 * Theme functions for the media_entity_soundcloud module.
 */

use Drupal\Core\Url;

/**
 * Prepares variables for media_entity_soundcloud_pro templates.
 *
 * Default template: media-soundcloud-embed-pro.html.twig.
 */
function template_preprocess_media_soundcloud_embed_pro(&$variables) {
  // Build the embed url.
  $uri = 'https://w.soundcloud.com/player/';

  // Build the query.
  $query = [
    'url' => 'https://api.soundcloud.com/' . $variables['source_id'],
  ];

  // Add color.
  if(!empty($variables['color'])) {
    $query['color'] = $variables['color'];
  }

  // Add options.
  foreach ($variables['options'] as $option => $value) {
    $query[$option] = $value == '0' ? 'false' : 'true';
  }

  $url = Url::fromUri($uri, ['query' => $query]);
  $variables['url'] = $url->toString();
}
